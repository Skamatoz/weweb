{"cacheVersion":157,"page":{"id":"899528c6-9334-4831-9c72-e1a02a78f74d","paths":{"en":"auth","default":"auth"},"cmsDataSetPath":null,"workflows":[{"id":"9175fb4b-d84b-427f-9772-d470b7c19a7e","icon":"workflow","name":"Авторизация","index":1,"actions":{"595123f2-5ced-4668-99dc-b58dc188bd13":{"id":"595123f2-5ced-4668-99dc-b58dc188bd13","code":"const script = document.createElement('script');\nscript.src = 'https://telegram.org/js/telegram-web-app.js';\n\nscript.onload = function () {\n  const tg = window.Telegram.WebApp;\n  tg.ready();\n\n  const initData = tg.initDataUnsafe;\n  if (!initData || !initData.user || !initData.user.id) {\n    // Если Telegram не передал user — не продолжаем\n    return;\n  }\n\n  const user = initData.user;\n  const telegramId = user.id.toString(); // На всякий случай делаем строкой\n\n  // Сохраняем ID\n  localStorage.setItem('telegram_id', telegramId);\n\n  // Проверка: есть ли такой пользователь в Xano\n  fetch(`https://x8ki-letl-twmt.n7.xano.io/api:Lj5PwYWo/get_profile?telegram_id=${telegramId}`)\n    .then(res => res.json())\n    .then(data => {\n      if (data && data.id) {\n        // Пользователь уже есть — редирект на главную\n        window.location.href = '/';\n      } else {\n        // Нет — создаём нового\n        fetch('https://x8ki-letl-twmt.n7.xano.io/api:Lj5PwYWo/telegram', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            telegram_id: telegramId,\n            first_name: user.first_name || '',\n            last_name: user.last_name || '',\n            username: user.username || '',\n            photo_url: user.photo_url || ''\n          })\n        })\n        .then(() => {\n          window.location.href = '/';\n        })\n        .catch(() => {\n          // Ошибка при создании — можно ничего не делать или показать ошибку\n        });\n      }\n    })\n    .catch(() => {\n      // Ошибка при проверке профиля\n    });\n};\n\ndocument.body.appendChild(script);\n","type":"custom-js"}},"trigger":"onload","isSearched":false,"description":"On page load","firstAction":"595123f2-5ced-4668-99dc-b58dc188bd13"},{"id":"df2f6bde-86f3-4f5d-a196-4f6418026acb","icon":"workflow","name":"Загрузка данных профиля","index":0,"actions":{"3d4df820-852f-4cee-ba14-494cfac989b8":{"id":"3d4df820-852f-4cee-ba14-494cfac989b8","type":"variable","varId":"f5c9a099-d70a-4f4f-b414-ff1e8eced119","usePath":false,"disabled":true,"internal":false,"varValue":{"code":"context.workflow['c20ec352-961c-4d10-b0da-d27d1658acda'].result?.['data']","__wwtype":"f"}},"c20ec352-961c-4d10-b0da-d27d1658acda":{"id":"c20ec352-961c-4d10-b0da-d27d1658acda","args":{"body":{},"endpoint":{"path":"/get_profile","method":"get"},"bodyFields":[],"parameters":{"telegram_id":{"code":"variables['3d5ad93e-5c59-4085-8acb-d6b54abad53b']","__wwtype":"f"}},"apiGroupUrl":"https://x8ki-letl-twmt.n7.xano.io/api:Lj5PwYWo"},"name":"Экшен загрузки","next":"3d4df820-852f-4cee-ba14-494cfac989b8","type":"cd33cf33-e29f-4e8c-ac26-b997fe507ce7-request","disabled":true},"fb086414-3386-4561-9130-527a2a721414":{"id":"fb086414-3386-4561-9130-527a2a721414","name":"Загрузка ID из Storage","next":"c20ec352-961c-4d10-b0da-d27d1658acda","type":"variable","varId":"3d5ad93e-5c59-4085-8acb-d6b54abad53b","disabled":true,"internal":false,"varValue":{"code":"const data = JSON.parse(localStorage.getItem('telegramUser')).id\nconsole.log('Полученные данные:', data);\nreturn data","__wwtype":"js"}}},"trigger":"onload","isSearched":false,"description":"On page load","firstAction":"fb086414-3386-4561-9130-527a2a721414","triggerConditions":null}]},"sections":{"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4":{"uid":"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4","linkId":"90dddab1-8e25-4b2d-b029-1bd262aee014","_state":{"style":{"mobile":{"width":"100%","height":"100%","aspectRatio":"unset"},"default":{}},"interactions":[{"id":"6c91c08e-b850-425b-8edf-cde5c69f5c52","actions":{"33fc1990-ecd9-4b5e-987a-296fb33cc27d":{"id":"33fc1990-ecd9-4b5e-987a-296fb33cc27d","next":null,"type":"variable","varId":"3d5ad93e-5c59-4085-8acb-d6b54abad53b","disabled":true,"internal":false,"varValue":{"code":"// читаем из localStorage\nconst storedId = localStorage.getItem('telegramId');\n// возвращаем (в WeWeb‑переменную запишется то, что вы вернёте)\nreturn storedId || '';","__wwtype":"js"}}},"trigger":"_wwOnMounted","firstAction":"33fc1990-ecd9-4b5e-987a-296fb33cc27d","triggerConditions":null}]},"content":{"mobile":{"_ww-layout_alignItems":"center"},"default":{"wwObjects":[{"uid":"eac4f2cb-5dc1-439c-8aa6-3588a41531a4","isWwObject":true}],"_ww-layout_alignItems":"flex-start","_ww-layout_flexDirection":"column"}},"sectionBaseId":"99586bd3-2b15-4d6b-a025-6a50d07ca845","sectionTitle":"Section"}},"wwObjects":{"afbf01e8-e5c5-47ca-9ce8-b68d3add5f3f":{"uid":"afbf01e8-e5c5-47ca-9ce8-b68d3add5f3f","_state":{"style":{"default":{}}},"content":{"mobile":{"_ww-text_fontSize":"20px"},"tablet":{},"default":{"tag":"h3","bgColor":"","shadows":"","fontStyle":"ww-font-style-header","textColor":"","globalStyle":{},"_ww-text_text":{"en":"<div>Heading</div>"},"transformation":"","_ww-text_ellipsis":false,"_ww-text_fontSize":"38px","_ww-text_sanitize":false}},"name":null,"wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentSectionId":"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4"},"e25c598d-7433-4a58-8ee9-51f6227f90e6":{"uid":"e25c598d-7433-4a58-8ee9-51f6227f90e6","_state":{"style":{"mobile":{"borderRadius":"20px"},"default":{"width":"100%","height":"100%"}},"states":[],"interactions":[]},"content":{"default":{"alt":{"en":"Forest path"},"url":"https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=2070&auto=format&fit=crop","loading":"lazy","objectFit":"cover"}},"name":null,"wwObjectBaseId":"3a7d6379-12d3-4387-98ff-b332bb492a63","libraryComponentBaseId":null,"parentSectionId":"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4"},"1b1b5032-7d08-4016-87db-f7832d576410":{"uid":"1b1b5032-7d08-4016-87db-f7832d576410","_state":{"style":{"mobile":{"width":"100%","height":"150px","padding":"20px","maxWidth":"185px","transition":null,"aspectRatio":"unset","borderRadius":"30px","backgroundColor":"#D6D6D6"},"default":{}},"interactions":[{"id":"693be5da-1d90-48f1-94d5-cadecb4a15f9","name":"Навигация по роли","actions":{"366af812-0108-421e-b163-2316af2a4107":{"id":"366af812-0108-421e-b163-2316af2a4107","type":"change-page","pageId":"1d08a59b-d388-4048-95da-6005533b26b5","navigateMode":"internal","openInNewTab":false},"44207315-35be-4e5c-90ae-b58a37e9bc8e":{"id":"44207315-35be-4e5c-90ae-b58a37e9bc8e","type":"switch","value":"First value","branches":[{"id":"f28a1163-e8d5-4ccd-bf93-5c57258f9dbb","value":"First value"},{"id":"8952de71-f55d-4987-9db5-db2afc19c40e","value":"Second value"},{"id":"df688425-1cde-44b0-9e44-cb552481ed10","value":"Third value"}]},"5e266603-4eb2-4a56-89f3-a6375c993b88":{"id":"5e266603-4eb2-4a56-89f3-a6375c993b88","next":"87e9b82d-6473-47b0-8b14-1768c5dcad2b","show":true,"type":"page-loader","color":"#FA3838"},"87e9b82d-6473-47b0-8b14-1768c5dcad2b":{"id":"87e9b82d-6473-47b0-8b14-1768c5dcad2b","next":"44207315-35be-4e5c-90ae-b58a37e9bc8e","type":"f5856798-485d-47be-b433-d43d771c64e1-fetchUser"},"8952de71-f55d-4987-9db5-db2afc19c40e":{"id":"8952de71-f55d-4987-9db5-db2afc19c40e","next":"366af812-0108-421e-b163-2316af2a4107","type":"filter","value":{"code":"pluginVariables['f5856798-485d-47be-b433-d43d771c64e1']['user']?.['role']!=\"admin\"","__wwtype":"f"}},"bdbbd65f-fabb-42d5-8981-384d3fb2be67":{"id":"bdbbd65f-fabb-42d5-8981-384d3fb2be67","type":"change-page","pageId":"cf97896a-188d-470e-9d42-99099c9f3da8","navigateMode":"internal","openInNewTab":false},"df688425-1cde-44b0-9e44-cb552481ed10":{"id":"df688425-1cde-44b0-9e44-cb552481ed10","type":"break-loop"},"f28a1163-e8d5-4ccd-bf93-5c57258f9dbb":{"id":"f28a1163-e8d5-4ccd-bf93-5c57258f9dbb","next":"bdbbd65f-fabb-42d5-8981-384d3fb2be67","type":"filter","value":{"code":"pluginVariables['f5856798-485d-47be-b433-d43d771c64e1']['user']?.['product']?.['product_1']==\"яшд\"||pluginVariables['f5856798-485d-47be-b433-d43d771c64e1']['user']?.['product']?.['product_2']==\"нг\"","__wwtype":"f"}}},"trigger":"click","description":"<p>Раз два оооо</p>","firstAction":"5e266603-4eb2-4a56-89f3-a6375c993b88"}]},"content":{"mobile":{"_ww-layout_pushLast":false,"_ww-layout_alignItems":"flex-start"},"default":{"children":[{"uid":"afbf01e8-e5c5-47ca-9ce8-b68d3add5f3f","isWwObject":true}],"_ww-layout_alignItems":"flex-start","_ww-layout_flexDirection":"column"}},"name":"item 1","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentSectionId":"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4"},"64c2d5fe-28dd-4841-990b-8100a0511763":{"uid":"64c2d5fe-28dd-4841-990b-8100a0511763","_state":{"style":{}},"content":{"default":{"children":[],"_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentSectionId":"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4"},"eac4f2cb-5dc1-439c-8aa6-3588a41531a4":{"uid":"eac4f2cb-5dc1-439c-8aa6-3588a41531a4","_state":{"style":{"mobile":{"width":"100%","height":"600px","aspectRatio":"unset"},"default":{}}},"content":{"mobile":{"_ww-layout_alignItems":"center","_ww-layout_justifyContent":"center"},"default":{"children":[{"uid":"ba1e1ba4-641c-452e-8320-6f7e1c93fb43","isWwObject":true}],"_ww-layout_alignItems":"flex-start","_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentSectionId":"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4"},"ba1e1ba4-641c-452e-8320-6f7e1c93fb43":{"uid":"ba1e1ba4-641c-452e-8320-6f7e1c93fb43","_state":{"style":{"mobile":{"flex":"0 1 auto","align":"center","height":"auto","padding":"0px 0px","aspectRatio":"unset","animationDuration":"1000ms","animationPlayState":"running"},"default":{"padding":"12px"}}},"content":{"mobile":{"size":"30px","color":"#F18B50"},"default":{"size":"50px","color":"#049AF2","spinner":"plane"}},"name":null,"wwObjectBaseId":"aa27b26f-0686-4c29-98c5-8217044045b7","libraryComponentBaseId":null,"parentSectionId":"a4bb3ce8-40ef-47e9-a739-8d7bf8db68a4"}},"collections":[],"variables":[{"id":"f5c9a099-d70a-4f4f-b414-ff1e8eced119","type":"object","name":"profile_data","defaultValue":{},"isLocalStorage":false,"isPersistentOnNav":true},{"id":"3d5ad93e-5c59-4085-8acb-d6b54abad53b","type":"string","name":"telegram_id","defaultValue":"","isLocalStorage":false,"isPersistentOnNav":true}],"workflows":[],"formulas":[],"libraryComponents":[]}